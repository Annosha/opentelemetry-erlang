{%- macro to_elixir_module(text) -%}
  {{ text | pascal_case }}
{%- endmacro -%}
{%- macro func_name(text) -%}
  {{ text | snake_case_const }}
{%- endmacro -%}
{%- macro to_atom(text) -%}
{#- waiting on https://github.com/open-telemetry/weaver/pull/207 for split to be available -#}
{% if text | split_id | length > 1 -%}:"{{ text }}"{%- else -%}:{{ text }}{%- endif %}
{%- endmacro -%}
{% macro to_elixir_type(member) -%}
  {%- if member.id == member.value -%}
    {{ to_atom(member.value) }}
  {%- else -%}
  {{ member }}
    {{ member.type | type_mapping }}
  {%- endif -%}
{%- endmacro %}
{%- macro enum_value_to_elixir_type(value) -%}
  {%- if value is string %}{{ to_atom(value) }}{% else -%}{{ value }}{%- endif %}
{%- endmacro -%}
{%- macro strong_reqs(string) -%}
  {{ string | replace(" MUST ", " **MUST** ") | replace(" MUST NOT ", " **MUST NOT** ") | replace(" SHOULD ", " **SHOULD** ") | replace(" SHOULD NOT ", " **SHOULD NOT** ") |  replace(" MAY ", replace=" **MAY** ") | replace(" NOT ", " **NOT** ") }}
{%- endmacro -%}

{%- set file_name = ctx.id | snake_case ~ "_attributes.ex" -%}
{%- set module_name = ctx.id | pascal_case -%}
{%- set trim_blocks = true %}
{%- set trim_lstrip_blocks = true %}
{{ template.set_file_name(file_name) }}

{%- set module_name = ctx.id | pascal_case ~ "Attributes" -%}
{{ params }}

defmodule OpenTelemetry.SemanticConventions.{{ module_name }} do
  @moduledoc """
  OpenTelemetry Semantic Conventions for Attributes.

```
{%- for attribute in ctx.attributes | sort(attribute="name") %}
  {{ attribute }}
{%- endfor %}
```
  """
{%- for attribute in ctx.attributes | sort(attribute="name") %}
{% if attribute.type is mapping %}
  {%- set type_name = attribute.name | snake_case_const %}
  {# @doc namespace: {{ to_atom(ctx.id) }} #}

  {% for member in attribute.type.members %}
  {% if member.id ~ '' != member.value -%}
  @type {{ member.id }}() :: {{ enum_value_to_elixir_type(member.value) }}
  {%- endif %}
  {% endfor %}
  @typedoc """
  {{ strong_reqs(attribute.brief) }}

  ### Options
  {% for member in attribute.type.members -%}
  * `{{ to_atom(member.id) }}`
  {%- if member is experimental %} ^[e](`m:OpenTelemetry.SemanticConventions#experimental`)^{% endif %}{% if member.brief != none %} - {% if member is deprecated %}**deprecated** ~~{% endif %}{{ member.brief }}{% if member is deprecated %}~~{% endif %}{% endif %}
  {% endfor %}
  """
  @type {{ attribute.name | snake_case_const }}() ::
    {%- for member in attribute.type.members -%}
    {% if loop.first %} {% endif %}{% if member.id ~ '' != member.value %}{{ member.id }}(){% else %}{{ enum_value_to_elixir_type(member.value) }}{% endif %}{% if not loop.last %} | {% endif %}
    {%- endfor -%}
    {% if attribute.type.allow_custom_values == true %} | atom(){% endif %}
  {%- endif %}
{%- endfor %}

  {# @doc """
  The URL of the OpenTelemetry schema for these keys and values.

      iex> OpenTelemetry.SemanticConventions.{{ to_elixir_module(root_namespace) }}.schema_url()
      "{{ schema_uri }}"
  """
  @spec schema_url :: String.t()
  def schema_url do
    "{{ schema_uri }}"
  end #}


{%- for attribute in ctx.attributes | sort(attribute="name") %}
{% if not(attribute.type is mapping) %}
 
  {# {%- if attribute|is_deprecated %}
  @deprecated """
  {{ attribute.deprecated | to_doc_brief | regex_replace(pattern="\n", replace="\n  ") }}
  """
  {%- else -%}
  @doc """
  {{ attribute }}
  {{ strong_reqs(attribute.brief | to_doc_brief | regex_replace(pattern="\n", replace="\n  ")) }}
  {%- if attribute.note %}

  ### Notes

  {{ strong_reqs(attribute.note | to_doc_brief | regex_replace(pattern="\n", replace="\n  ")) }}
  {%- endif %}

      iex> OpenTelemetry.SemanticConventions.{{ to_elixir_module(root_namespace) }}.{{ funcName(attribute.fqn) }}()
      :"{{ attribute.fqn }}"

  """
  {%- endif %} #}
  @spec {{ func_name(attribute.name) }} :: {{ to_atom(attribute.name) }}
  def {{ func_name(attribute.name) }} do
    {{ to_atom(attribute.name) }}
  end
  {%- endif %}
{%- endfor %}
end
